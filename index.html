<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Ghi điểm đẹp vl</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  :root {
    --hawk: linear-gradient(135deg, #4facfe, #00f2fe);
    --horse: linear-gradient(135deg, #fa71cd, #c471f5);
    --hedgehog: linear-gradient(135deg, #ff9a9e, #fad0c4);
    --shark: linear-gradient(135deg, #ff6a6a, #ee5a5a);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: #000;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    min-height: 100vh;
    padding: env(safe-area-inset-top, 44px) 15px env(safe-area-inset-bottom, 20px);
  }
  .player {
    position: relative;
    width: 100%;
    max-width: 500px;
    margin: 18px auto;
    border-radius: 28px;
    overflow: hidden;
    box-shadow: 0 15px 35px rgba(0,0,0,0.6);
  }
  .bg { padding: 24px 28px 32px; }
  .hawk .bg    { background: var(--hawk); }
  .horse .bg   { background: var(--horse); }
  .hedgehog .bg{ background: var(--hedgehog); }
  .shark .bg   { background: var(--shark); }

  .menu-dots {
    position: absolute;
    top: 18px; right: 20px;
    font-size: 32px;
    opacity: 0.7;
    cursor: pointer;
  }
  .name {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 8px;
  }
  .controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  button {
    background: rgba(255,255,255,0.25);
    border: none;
    color: white;
    width: 72px; height: 72px;
    border-radius: 50%;
    font-size: 48px;
    font-weight: bold;
    cursor: pointer;
    backdrop-filter: blur(10px);
    transition: all 0.15s;
  }
  button:active { transform: scale(0.88); background: rgba(255,255,255,0.4); }
  .score {
    font-size: 82px;
    font-weight: 900;
    min-width: 160px;
    text-align: center;
    transition: transform 0.2s;
  }
  .score.jump { animation: jump 0.35s ease-out; }
  @keyframes jump { 0%,100%{transform:scale(1)} 50%{transform:scale(1.35)} }

  .fab {
    position: fixed;
    bottom: 30px; right: 30px;
    width: 66px; height: 66px;
    background: linear-gradient(135deg, #8e24aa, #ff7043);
    border-radius: 50%;
    font-size: 36px;
    color: white;
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 100;
  }
</style>
</head>
<body>

<div id="app">
  <div v-for="(p, i) in players" :key="i" class="player" :class="colors[i]">
    <div class="bg">
      <div class="menu-dots">⋯</div>
      <div class="name">{{ p.name }}</div>
      <div class="controls">
        <button @click="change(i, -1)">–</button>
        <div class="score" :class="{jump: p.jump}">{{ p.score }}</div>
        <button @click="change(i, 1)">+</button>
      </div>
    </div>
  </div>

  <button class="fab" @click="showModal=true">
    <i class="fas fa-plus"></i>
  </button>
</div>

<!-- Modal đổi tên người chơi -->
<div class="modal-overlay" v-if="showModal" @click="showModal=false">
  <div class="modal-content" @click.stop>
    <h2>Nhập tên người chơi</h2>
    <input v-model="input" placeholder="Hawk, Horse, Hedgehog, Shark" @keyup.enter="saveNames">
    <div style="margin-top:20px; text-align:right;">
      <button @click="showModal=false" style="margin-right:12px; padding:12px 24px; background:#555; border-radius:12px;">Hủy</button>
      <button @click="saveNames" style="padding:12px 28px; background:#8e24aa; border-radius:12px;">OK</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
const { createApp } = Vue
createApp({
  data() {
    return {
      colors: ['hawk','horse','hedgehog','shark'],
      players: [
        {name:'Hawk', score:0, jump:false},
        {name:'Horse', score:0, jump:false},
        {name:'Hedgehog', score:0, jump:false},
        {name:'Shark', score:0, jump:false}
      ],
      showModal: false,
      input: '',
      db: null,
      history: []
    }
  },
  methods: {
    change(i, delta) {
      this.players[i].score += delta
      this.players[i].jump = true
      setTimeout(()=> this.players[i].jump = false, 350)
      this.saveState()
    },
    saveNames() {
      const names = this.input.split(',').map(s=>s.trim()).filter(Boolean)
      if(names.length===4){
        this.players = names.map((n,i)=>({name:n, score:0, jump:false}))
        this.history = []
        this.clearHistoryDB()
        this.saveState()
      }
      this.showModal = false
    },
    // === IndexedDB giữ nguyên như cũ ===
    initDB() {
      const req = indexedDB.open('ScoreAppV2', 2)
      req.onupgradeneeded = e => {
        const db = e.target.result
        if(!db.objectStoreNames.contains('state')) db.createObjectStore('state',{keyPath:'id'})
        if(!db.objectStoreNames.contains('history')) db.createObjectStore('history',{autoIncrement:true})
      }
      req.onsuccess = e => {
        this.db = e.target.result
        this.loadState()
      }
    },
    saveState() {
      if(!this.db) return
      const tx = this.db.transaction('state','readwrite')
      tx.objectStore('state').put({id:'main', players: this.players})
    },
    loadState() {
      if(!this.db) return
      const tx = this.db.transaction('state','readonly')
      const req = tx.objectStore('state').get('main')
      req.onsuccess = () => {
        if(req.result && req.result.players.length===4){
          this.players = req.result.players.map(p=>({...p, jump:false}))
        }
      }
    },
    clearHistoryDB() {
      if(!this.db) return
      this.db.transaction('history','readwrite').objectStore('history').clear()
    }
  },
  mounted() {
    this.initDB()
    // Nếu chưa có tên thì tự mở modal
    setTimeout(()=>{
      if(this.players.every(p=>p.name.includes('Player') || p.name==='' )) this.showModal=true
    },800)
  }
}).mount('#app')
</script>
</body>
</html>